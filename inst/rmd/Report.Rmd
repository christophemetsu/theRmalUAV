```{r, echo = F, warning=F, message=F}
Date <- as.Date(thermal_uav@Info@TTime[1])

```

# `r project_name`

Thermal UAV Report generated by the thermal_uav R-package

### General Information

**Flight:** `r flight_name`

**Date:** `r Date`

**Pilot:** `r pilot_name`

**camera:** `r thermal_uav@Info@camera`

**Number of images:** `r thermal_uav@Info@dataset_length`

### Position Information

```{r, echo = F,include=T, warning=F, message=F}
if (length(thermal_uav@Position@overlap) == 0){
  overlap <- "Not calculated"
} else {
  overlap <- thermal_uav@Position@overlap
}
```

**Overlap images:** `r overlap`

**Camera Positions**
```{r, echo = F,include=T, warning=F, message=F}
if (length(terra::unwrap(thermal_uav@Position@extents_vector)) != 0){
  terra::plet(terra::unwrap(thermal_uav@Position@extents_vector))
} else if (length(terra::unwrap(thermal_uav@Position@locations_vector)) != 0){
  terra::plet(terra::unwrap(thermal_uav@Position@locations_vector))
} else if (all((thermal_uav@Position@Lat != 0) & (thermal_uav@Position@Lon != 0))) {
  df <- data.frame(
    Images = thermal_uav@Info@images,
    lat = thermal_uav@Position@Lat,
    lon = thermal_uav@Position@Lon
  )
  terra::plet(terra::vect(df, crs = "epsg:4326"))
} else {
  cat("No camera positions/extents were found")
}
```

```{r, echo = F,include=T, warning=F, message=F}
if (length(thermal_uav@Position@tuav_coreg) == 0){
  tuav_coreg <- "Not calculated"
  rig_offset <-  ""
  timediff <-  ""
} else {
  tuav_coreg <- "Yes"
  rig_offset <-  thermal_uav@Position@rig_offset
  timediff <-  thermal_uav@Position@timediff
}
```

**tuav_coreg:** `r tuav_coreg`

Rig offset: `r rig_offset`

Time difference: `r timediff`

### Data Cleaning

```{r, echo = F,include=T, warning=F, message=F}
if (length(thermal_uav@Sharpness@tuav_persec) == 0){
  tuav_persec <- "Not calculated"
  number_keep <-  ""
  img_persec_remove <-  ""
} else {
  tuav_persec <- "Yes"
  number_keep <- thermal_uav@Sharpness@number_keep
  img_persec_remove <- thermal_uav@Sharpness@img_persec_remove
}
```

**tuav_persec:** `r tuav_persec`

Number of images per second: `r number_keep`

Number of images removed: `r img_persec_remove`

```{r, echo = F,include=T, warning=F, message=F}
if (length(thermal_uav@Sharpness@tuav_reduc) == 0){
  tuav_reduc <- "Not calculated"
  method <-  ""
  min_overlap <- ""
  Thresh <- ""
  img_reduc_remove <- ""
  unsharp_kept_ID <- ""
} else {
  tuav_reduc <- "Yes"
  method <-  thermal_uav@Sharpness@method
  min_overlap <- thermal_uav@Position@min_overlap
  Thresh <- thermal_uav@Sharpness@Thresh
  img_reduc_remove <- thermal_uav@Sharpness@img_reduc_remove
  unsharp_kept_ID <- thermal_uav@Sharpness@unsharp_kept_ID
}
```

**tuav_reduc:** `r tuav_reduc`

Method: `r method`

Minimal overlap: `r min_overlap`

Sharpness threshold: `r Thresh`

Number of images removed: `r img_reduc_remove`

Unsharp images kept: `r unsharp_kept_ID`

### Data Correction

```{r, echo = F,include=T, warning=F, message=F}
if (length(thermal_uav@Atmosphere@tuav_correct) == 0){
  tuav_correct <- "Not calculated"
  air_temperature <-  ""
  air_temp_method <- ""
  relative_humidity <- ""
  omega <- ""
  transmissie <- ""
  emiss <- ""
  T_bg <- ""
} else {
  tuav_correct <- "Yes"
  air_temperature <- mean(thermal_uav@Atmosphere@T_air)
  relative_humidity <- mean(thermal_uav@Atmosphere@rel_hum)
  omega <- mean(thermal_uav@Atmosphere@omega)
  transmissie <- mean(thermal_uav@Atmosphere@Tau_atm)
  if (thermal_uav@Atmosphere@T_air_mode == 1){
    air_temp_method <- "Mean of image temperatures"
  } else if (thermal_uav@Atmosphere@T_air_mode == 2){
    air_temp_method <- "Single value"
  } else if (thermal_uav@Atmosphere@T_air_mode == 3){
    air_temp_method <- "Vector with same length as images"
  } else if (thermal_uav@Atmosphere@T_air_mode == 4){
    air_temp_method <- "Dataset with high temporal resolution temperture"
  }
  emiss <- thermal_uav@Atmosphere@emiss
  if (thermal_uav@Atmosphere@T_bg == 0){
    T_bg <- "Not provided"
  } else {
      T_bg <- thermal_uav@Atmosphere@T_bg
  }
}
```

**tuav_correct:** `r tuav_correct`

Air temperature: `r air_temperature`

Air temperature method: `r air_temp_method`

Relative Humidity: `r relative_humidity`

Omega: `r omega`

Atm transmission: `r transmissie`

Emissivity: `r emiss`

Background temperature: `r T_bg`

```{r, echo = F,include=T, warning=F, message=F}
if (length(thermal_uav@Smooth@tuav_smooth) == 0){
  tuav_smooth <- "Not calculated"
  method <-  ""
  smooth_length <-  ""
  T_corr <- ""
} else {
  tuav_smooth <- "Yes"
  method <- thermal_uav@Smooth@method
  smooth_length <- thermal_uav@Smooth@smooth_length
  T_corr <- mean(abs(thermal_uav@Smooth@T_smooth))
}
```

**tuav_smooth:** `r tuav_smooth`

Method: `r method`

Smooth length: `r smooth_length`

Mean correction: `r T_corr` 



