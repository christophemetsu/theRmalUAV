<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="theRmalUAV">
<title>Orthomosaic-based Workflow • theRmalUAV</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Orthomosaic-based Workflow">
<meta property="og:description" content="theRmalUAV">
<meta property="og:image" content="https://christophemetsu.github.io/theRmalUAV/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">theRmalUAV</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Orthomosaic-based Workflow</h1>
            
      
      
      <div class="d-none name"><code>Orthomosaic-based_Workflow.Rmd</code></div>
    </div>

    
    
<style>
body {
text-align: justify}
</style>
<div class="section level2">
<h2 id="overview">1. Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>In this article we will go over the orthomosaic-based workflow step
by step. The orthomosaic-based workflow is intended to perform
corrections on an orthomosaic containing uncorrected brightness
temperatures and is presented in the Figure bellow. We will showcase
these steps with an example using the Micasense Altum-PT camera. This
camera collects tiff images in the blue, green, red, red-edge,
near-infrared, as well as the thermal infrared range. The thermal data
is stored as centikelvin.</p>
<p><img src="figures/Workflow_orthomosaic_based_3.png" width="100%">
# 2. Load the necessary data</p>
<p>First, the multiband data was stitched into a multispectral
orthomosaic using Agisoft Metashape (other phogrammetry software is also
possible), following <a href="https://agisoft.freshdesk.com/support/solutions/articles/31000148381-micasense-altum-processing-workflow-including-reflectance-calibration-in-agisoft-metashape-professi" class="external-link">this
workflow</a>. This resulted in a multispectral orthomosaic with the
reflectance in blue, green, red, red-edge and near infra-red, as well as
temperature in °C. We first load the data and select the right bands for
further processing.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">theRmalUAV</span><span class="op">)</span> <span class="co"># For thermal processing</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span>      <span class="co"># For working with rasters</span></span>
<span></span>
<span><span class="va">MSP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="st">"E:/Thermal_Project/MSP_ortho_micasense.tif"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">MSP</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BLU"</span>, <span class="st">"GRE"</span>, <span class="st">"RED"</span>, <span class="st">"REG"</span>, <span class="st">"NIR"</span>, <span class="st">"TIR"</span><span class="op">)</span></span>
<span><span class="va">TIR</span> <span class="op">&lt;-</span> <span class="va">MSP</span><span class="op">$</span><span class="va">TIR</span></span>
<span><span class="va">NDVI</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">MSP</span><span class="op">$</span><span class="va">NIR</span> <span class="op">-</span> <span class="va">MSP</span><span class="op">$</span><span class="va">RED</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">MSP</span><span class="op">$</span><span class="va">NIR</span> <span class="op">+</span> <span class="va">MSP</span><span class="op">$</span><span class="va">RED</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">NDVI</span>, main <span class="op">=</span> <span class="st">"NDVI"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">TIR</span>, main <span class="op">=</span> <span class="st">"Brightness temperature in °C"</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/mappal.html" class="external-link">map.pal</a></span><span class="op">(</span><span class="st">"magma"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/Ortho_NDVI.png" width="100%"></p>
<p><img src="figures/Ortho_brightT.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="conversion-to-lst">3. Conversion to LST<a class="anchor" aria-label="anchor" href="#conversion-to-lst"></a>
</h2>
<p>Once the NDVI map is created, we can account for the emissivity in a
spatially explicit way using the NDVI threshold method. In this example
we are going to set tho following parameters, the emissivity values were
taken from <a href="https://doi.org/10.1016/S0034-4257(96)00123-X" class="external-link">this
paper</a>:</p>
<ul>
<li>NDVI<sub>veg</sub> = 0.8</li>
<li>NDVI<sub>soil</sub> = 0.1</li>
<li>ϵ<sub>veg</sub> = 0.984 (Emissivity for shrubs)</li>
<li>ϵ<sub>soil</sub> = 0.914 (Emissivity for sandsoils)</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">LST_correct</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ortho_correct.html">ortho_correct</a></span><span class="op">(</span>thermal_ortho <span class="op">=</span> <span class="va">TIR</span>,</span>
<span>                             temp <span class="op">=</span> <span class="st">"C"</span>,         <span class="co"># Thermal map is in °C</span></span>
<span>                             flight_height <span class="op">=</span> <span class="fl">75</span>, <span class="co"># in meter</span></span>
<span>                             T_air <span class="op">=</span> <span class="fl">18.6</span>,       <span class="co"># in °C</span></span>
<span>                             rel_hum <span class="op">=</span> <span class="fl">46.1</span>,     <span class="co"># in %</span></span>
<span>                             T_bg <span class="op">=</span> <span class="fl">286.65</span>,      <span class="co"># in Kelvin</span></span>
<span>                             emiss <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                             method <span class="op">=</span> <span class="st">"NDVI"</span>,</span>
<span>                             corrmap <span class="op">=</span> <span class="va">NDVI</span>,</span>
<span>                             NDVI_veg <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>                             NDVI_soil <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                             emiss_veg <span class="op">=</span> <span class="fl">0.984</span>,</span>
<span>                             emiss_soil <span class="op">=</span> <span class="fl">0.914</span><span class="op">)</span></span></code></pre></div>
<p>The function <code><a href="../reference/ortho_correct.html">ortho_correct()</a></code> returns a SpatRaster
object. You can plot and export it as geotiff using the
terra-package:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">LST_correct</span>, main <span class="op">=</span> <span class="st">"Land surface temperature in °C"</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/mappal.html" class="external-link">map.pal</a></span><span class="op">(</span><span class="st">"magma"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">LST_correct</span>, <span class="st">"E:/Thermal_Project/LST_micasense.tif"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/Ortho_LST.png" width="100%"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Christophe Metsu.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
